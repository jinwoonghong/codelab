## '타워 스태커' 게임 기획 및 개발 문서

제안하신 '타워 스태커' 모바일 웹게임을 더욱 구체화하기 위한 기획서, 테크 문서, 요구사항 명세서, 그리고 기능별 To-Do List를 제공합니다. 이 문서들을 바탕으로 AI에게 개발을 요청할 수 있습니다.

---

### 1. 게임 기획서 (Game Design Document)

#### 1.1. 게임 개요
'타워 스태커'는 블록을 쌓아 올리는 간단한 행위에서 오는 원초적인 재미와 물리 엔진의 예측 불가능성을 결합한 모바일 웹 기반 퍼즐 아케이드 게임입니다. 중고등학생을 주요 타겟으로, 짧은 플레이 타임과 직관적인 조작감을 제공하면서도, 다양한 특수 블록, 환경 변수, 그리고 독특한 경쟁 및 수집 요소를 통해 깊이 있는 경험을 선사합니다. 서버 없이 로컬 DB만을 활용하여 어디서든 쉽게 접근하고 즐길 수 있도록 설계됩니다.

#### 1.2. 타겟 유저
*   **주요 타겟:** 중고등학생 (13세 ~ 19세)
*   **특징:** 짧은 시간에 즉각적인 재미를 추구, 친구들과의 가벼운 경쟁 선호, 수집 및 꾸미기 요소에 관심, 스마트폰 친숙.

#### 1.3. 핵심 재미 요소
*   **직관적인 조작:** 한 번의 탭으로 블록을 떨어뜨리는 단순함.
*   **물리 엔진 기반의 예측 불가능성:** 블록의 모양, 무게, 놓는 위치에 따른 다양한 결과와 아슬아슬한 긴장감.
*   **순간적인 판단과 전략:** 특수 블록 활용 및 환경 변수 대응.
*   **성장과 수집의 만족감:** 새로운 블록 스킨, 테마, 칭호 획득.
*   **친구와의 비동기적 경쟁:** '챌린지 코드'와 '고스트 리플레이'를 통한 기록 경쟁 및 자랑.

#### 1.4. 강화된 핵심 게임플레이
*   **특수 블록:**
    *   **접착 블록:** 착지 시 주변 블록과 잠시 접착되어 안정성을 높임.
    *   **고무 블록:** 탄성이 강하여 튕겨 오르거나 미끄러지기 쉽지만, 충격 흡수 효과.
    *   **가속 블록:** 낙하 속도가 매우 빠르지만, 성공적인 안착 시 추가 점수.
    *   **유리 블록:** 매우 가볍고 섬세하여 쉽게 깨지지만, 높이 쌓기에 유리.
*   **환경 변수:**
    *   **돌풍:** 일정 높이 도달 시, 무작위 방향에서 강한 바람이 불어 타워를 흔들림.
    *   **중력 변화:** 특정 시점에 중력이 일시적으로 강해지거나 약해져 블록 낙하 속도 및 타워 안정성에 영향.
    *   **방해 드론:** 화면을 가로지르며 블록을 살짝 건드려 균형을 방해.

#### 1.5. 다채로운 게임 모드
*   **클래식 모드:** 가장 높이 쌓는 것을 목표로 하는 기본 모드. 개인 최고 기록 갱신.
*   **타임 어택 모드:** 제한 시간(예: 90초) 내에 가장 높이 쌓는 것을 목표.
*   **일일 도전 모드:** 매일 동일한 순서의 블록이 주어지는 모드. 로컬 시간을 기준으로 블록 시퀀스 생성 로직을 활용하여 서버 없이 모든 유저가 동일한 조건에서 플레이 가능.
*   **퍼즐 모드:** 특정 모양/높이 등 주어진 미션을 정해진 블록으로 클리어하는 스테이지 방식.

#### 1.6. 깊이 있는 성장 및 수집 요소
*   **블록 스킨 & 테마:** 게임 플레이로 얻는 코인으로 '뽑기'를 통해 다양한 모양과 재질의 블록 스킨(예: 고양이 블록, 우주 테마 블록, 투명 블록 등) 및 테마(배경, 낙하 이펙트) 획득.
*   **업적 및 칭호 시스템:** 특정 높이 도달, 특정 블록 활용, 특정 모드 클리어 등 다양한 조건을 달성하면 업적이 해금되고, 해당 업적에 따른 칭호 획득 및 표시 가능.
*   **나만의 박물관:** 획득한 모든 블록 스킨과 테마를 3D로 전시하고 감상할 수 있는 공간.

#### 1.7. 확장된 경쟁 및 공유 기능 (서버 없이 로컬 DB 활용)
*   **'고스트' 리플레이 기능:**
    *   자신 또는 친구의 최고 기록 '챌린지 코드'를 입력하면, 해당 기록을 달성한 플레이가 반투명 '고스트' 타워로 내 게임 화면에 함께 나타남.
    *   **챌린지 코드:** 블록 생성 순서, 각 블록의 드롭 시간 및 x축 위치 등의 데이터를 암호화하여 생성. 이를 통해 서버 없이도 동일한 조건에서 비동기 경쟁 가능.
*   **'명장면 GIF' 생성 및 공유:**
    *   최고 기록 경신, 아슬아슬한 타워 붕괴 등 극적인 순간을 자동으로 감지하여 3~5초 길이의 GIF(움짤)로 생성.
    *   생성된 GIF를 게임 내에서 바로 다운로드하거나, 모바일 OS의 공유 기능을 통해 SNS, 메신저 등으로 쉽게 공유.

---

### 2. 테크 문서 (Technical Design Document)

#### 2.1. 기술 스택
*   **언어:** HTML5, CSS3, JavaScript (ES6+)
*   **프레임워크/라이브러리:**
    *   **게임 엔진/렌더링:** Phaser 3 (2D 물리 엔진, 렌더링, 입력 처리 용이) 또는 Pixi.js (렌더링에 특화, 물리 엔진은 Matter.js 또는 Box2D 별도 연동)
    *   **물리 엔진:** Phaser 내장 물리 엔진 (Matter.js 또는 Arcade Physics) 또는 standalone Matter.js
    *   **로컬 DB:** IndexedDB (복잡한 게임 데이터 저장), LocalStorage (간단한 설정, 플래그 저장)
    *   **GIF 생성:** `gif.js` 또는 `whammy.js` 등 클라이언트 측 GIF 인코딩 라이브러리
    *   **데이터 암호화/압축:** `LZ-String` (간단한 데이터 압축), `crypto-js` (챌린지 코드 암호화/복호화)

#### 2.2. 아키텍처
*   **클라이언트-사이드 온리 (Client-Side Only):** 모든 게임 로직, 데이터 저장 및 처리, 통신(공유 기능)은 사용자 기기 내에서만 이루어짐. 서버와의 데이터 송수신 없음.
*   **모듈화된 JavaScript:** 게임 로직, UI, 데이터 관리, 물리 처리 등을 각각의 모듈로 분리하여 코드의 가독성 및 유지보수성 향상.
*   **게임 상태 관리:** Phaser Scene Manager를 활용하여 각 게임 모드, 메뉴 화면을 별도의 Scene으로 관리.

#### 2.3. 데이터 저장 방식 (로컬 DB 활용)
*   **IndexedDB:**
    *   **사용처:** 사용자 최고 기록 (각 모드별), 획득한 블록 스킨/테마 목록, 업적 달성 여부, 챌린지 코드 이력, 박물관 데이터.
    *   **구조:** Object Store를 활용하여 structured data 저장. (예: `highScores` Object Store에는 `{ mode: 'classic', score: 150, timestamp: ... }` 형태, `inventory` Object Store에는 `{ type: 'skin', id: 'catBlock', acquired: true }` 형태)
*   **LocalStorage:**
    *   **사용처:** 게임 설정 (사운드 볼륨, 언어), 마지막 플레이 모드, 간단한 플래그 (튜토리얼 완료 여부).
    *   **구조:** Key-Value 형태로 문자열 데이터 저장.

#### 2.4. 물리 엔진 구현
*   **블록 객체:** 각 블록은 물리 바디(Body)와 렌더링 객체(Sprite)를 가짐. 무게, 마찰, 반발력 등 물리 속성 정의.
*   **타워 안정성 판정:** 타워의 무게중심이 지지 기반을 벗어나거나, 일정 각도 이상 기울어지면 붕괴로 판정.
*   **충돌 감지:** 블록 간, 블록과 바닥 간의 충돌 처리.

#### 2.5. 블록 생성 및 관리
*   **블록 풀링 (Object Pooling):** 블록 생성/파괴 비용 절감을 위해 재활용 가능한 블록 객체 풀 관리.
*   **블록 순서 제어:**
    *   **클래식/타임 어택:** 무작위 블록 생성.
    *   **일일 도전/챌린지 코드:** 특정 시드 값을 기반으로 결정론적 블록 시퀀스 생성 로직 구현.
*   **특수 블록 등장 로직:** 일정 확률 또는 특정 조건(예: 5번째 블록마다)으로 특수 블록 등장.

#### 2.6. 리플레이 및 고스트 기능 구현
*   **플레이 데이터 기록:** `[{ time: 100ms, blockType: 'square', dropX: 150 }, { time: 1200ms, blockType: 'circle', dropX: 200 }, ...]`와 같이 블록 드롭 시점의 시간, 블록 종류, X좌표를 배열 형태로 기록.
*   **챌린지 코드 생성:** 위 플레이 데이터를 압축 및 암호화하여 짧은 문자열 코드로 변환 (URL-safe base64 인코딩 사용).
*   **챌린지 코드 파싱:** 코드를 복호화하고 압축 해제하여 플레이 데이터를 복원.
*   **고스트 렌더링:** 복원된 플레이 데이터를 기반으로 게임 플레이를 재현하되, 블록은 반투명하게 렌더링하고 물리 충돌은 발생시키지 않음.

#### 2.7. GIF 생성 구현
*   **화면 녹화:** 게임 캔버스의 특정 영역을 주기적으로 캡처 (requestAnimationFrame 이용).
*   **인코딩:** 캡처된 이미지 프레임을 클라이언트 측 GIF 인코딩 라이브러리를 사용하여 GIF 파일로 변환.
*   **트리거:** 최고 기록 경신, 타워 붕괴 등 특정 이벤트 발생 시 자동으로 녹화 시작 및 종료.
*   **공유:** 생성된 GIF 파일을 Blob으로 변환 후, `window.navigator.share` (Web Share API) 또는 다운로드 링크 제공.

#### 2.8. 환경 변수 구현
*   **트리거:** 타워 높이, 경과 시간 등 특정 조건 달성 시 환경 변수 이벤트 발동.
*   **물리 효과 적용:**
    *   **돌풍:** 모든 블록에 일시적으로 특정 방향으로 힘(force) 가하기.
    *   **중력 변화:** 물리 엔진의 중력 값 일시적으로 변경.
    *   **방해 드론:** 드론 객체가 특정 경로로 이동하며, 경로 내 블록과 약한 충돌 발생.

#### 2.9. 보안 (클라이언트-사이드 한계점)
*   **데이터 조작 가능성:** 모든 데이터가 클라이언트 기기에 저장되므로, 숙련된 사용자라면 데이터(점수, 아이템 등)를 조작할 수 있는 한계점이 존재. 이를 인지하고, 서버 기반 게임에서 요구되는 수준의 보안은 적용하기 어려움을 명시. 경쟁 요소는 '친구와의 가벼운 공유 및 도전'에 중점을 둠.

---

### 3. 요구사항 명세서 (Requirements Specification)

#### 3.1. 기능적 요구사항 (Functional Requirements)

*   **FR1.0 게임 시작/종료:**
    *   FR1.1 메인 화면에서 게임 시작 버튼을 제공해야 한다.
    *   FR1.2 게임 오버 시 결과 화면을 표시해야 한다.
    *   FR1.3 게임 중 언제든지 일시정지 및 재시작, 메인 화면으로 돌아가기 기능을 제공해야 한다.
*   **FR2.0 블록 드롭 및 물리 시뮬레이션:**
    *   FR2.1 화면 터치 시 블록이 떨어지기 시작해야 한다.
    *   FR2.2 블록은 중력과 물리 법칙에 따라 움직여야 한다.
    *   FR2.3 블록 간, 블록과 바닥 간의 충돌을 정확히 시뮬레이션해야 한다.
    *   FR2.4 타워가 일정 기준 이상으로 기울어지거나 블록이 바닥(또는 특정 높이)을 이탈하면 게임 오버로 처리해야 한다.
*   **FR3.0 점수 계산 및 기록:**
    *   FR3.1 타워의 최고 높이를 실시간으로 표시해야 한다.
    *   FR3.2 게임 종료 시, 도달한 최고 높이를 점수로 기록해야 한다.
    *   FR3.3 각 게임 모드별 최고 점수를 로컬 DB에 저장하고, 메인 화면 또는 기록 메뉴에서 조회할 수 있어야 한다.
*   **FR4.0 게임 모드:**
    *   FR4.1 클래식 모드, 타임 어택 모드, 일일 도전 모드, 퍼즐 모드를 제공해야 한다.
    *   FR4.2 일일 도전 모드는 매일 동일한 블록 시퀀스를 제공해야 한다.
    *   FR4.3 퍼즐 모드는 여러 스테이지와 각 스테이지별 클리어 조건을 제공해야 한다.
*   **FR5.0 특수 블록 및 환경 변수:**
    *   FR5.1 접착, 고무, 가속, 유리 등 특수 블록의 기능을 구현해야 한다.
    *   FR5.2 돌풍, 중력 변화, 방해 드론 등 환경 변수 효과를 구현해야 한다.
    *   FR5.3 특수 블록 및 환경 변수의 등장/발동 로직을 구현해야 한다.
*   **FR6.0 성장 및 수집 요소:**
    *   FR6.1 게임 플레이 결과에 따라 코인을 획득할 수 있어야 한다.
    *   FR6.2 획득한 코인으로 블록 스킨/테마를 뽑을 수 있는 상점(뽑기) 기능을 제공해야 한다.
    *   FR6.3 다양한 업적 달성 시 칭호를 획득하고 적용할 수 있어야 한다.
    *   FR6.4 획득한 모든 블록 스킨/테마를 3D로 감상할 수 있는 박물관 기능을 제공해야 한다.
*   **FR7.0 경쟁 및 공유 기능:**
    *   FR7.1 자신의 최고 기록을 기반으로 '챌린지 코드'를 생성하고 복사할 수 있어야 한다.
    *   FR7.2 '챌린지 코드'를 입력하여 친구의 기록을 확인하고 '고스트'와 함께 플레이할 수 있어야 한다.
    *   FR7.3 최고 기록 경신 또는 타워 붕괴 시 자동으로 명장면 GIF를 생성해야 한다.
    *   FR7.4 생성된 GIF를 저장하거나 외부 SNS로 공유할 수 있어야 한다.
*   **FR8.0 사용자 인터페이스 (UI):**
    *   FR8.1 직관적이고 모바일에 최적화된 UI를 제공해야 한다.
    *   FR8.2 점수, 높이, 남은 시간 등 핵심 정보는 항상 명확하게 표시되어야 한다.
    *   FR8.3 설정 (사운드, 진동 등) 및 도움말 화면을 제공해야 한다.
*   **FR9.0 사운드 및 이펙트:**
    *   FR9.1 배경 음악과 다양한 효과음(블록 드롭, 충돌, 붕괴 등)을 제공해야 한다.
    *   FR9.2 환경 변수 발동 시 시각적/청각적 이펙트를 제공해야 한다.

#### 3.2. 비기능적 요구사항 (Non-Functional Requirements)

*   **NFR1.0 성능:**
    *   NFR1.1 대부분의 현대 모바일 기기에서 60 FPS 이상으로 원활하게 작동해야 한다.
    *   NFR1.2 물리 시뮬레이션은 지연 없이 실시간으로 이루어져야 한다.
*   **NFR2.0 호환성:**
    *   NFR2.1 최신 버전의 Chrome, Safari, Firefox 등 주요 모바일 웹 브라우저에서 정상적으로 작동해야 한다.
    *   NFR2.2 다양한 화면 해상도를 가진 모바일 기기에서 UI가 정상적으로 표시되어야 한다 (반응형 웹).
*   **NFR3.0 사용성:**
    *   NFR3.1 게임 플레이는 단일 탭 조작으로 간편해야 한다.
    *   NFR3.2 사용자 경험은 직관적이고 학습 곡선이 낮아야 한다.
*   **NFR4.0 안정성:**
    *   NFR4.1 게임 플레이 중 예기치 않은 종료나 데이터 손실이 없어야 한다.
    *   NFR4.2 로컬 DB의 데이터는 손상되지 않고 지속적으로 유지되어야 한다.
*   **NFR5.0 접근성:**
    *   NFR5.1 사운드 ON/OFF, 진동 ON/OFF 등 기본적인 접근성 옵션을 제공해야 한다.
*   **NFR6.0 로컬 저장소 효율성:**
    *   NFR6.1 로컬 DB 사용량은 일반적인 모바일 브라우저의 저장소 제한 범위 내에 있어야 한다.
    *   NFR6.2 챌린지 코드는 효율적으로 압축되어 짧은 문자열로 생성되어야 한다.

---

### 4. 기능별 To-Do List

#### 4.1. 핵심 게임 루프 (Core Game Loop)
*   [ ] 게임 캔버스 및 물리 엔진 초기화
*   [ ] 바닥 지지대 구현
*   [ ] 블록 생성 및 화면 상단 위치 지정 (무작위 또는 시퀀스 기반)
*   [ ] 화면 터치 이벤트 리스너 구현 (블록 드롭)
*   [ ] 블록 낙하 및 물리 시뮬레이션 (충돌, 중력 등)
*   [ ] 타워 높이 실시간 계산 및 UI 표시
*   [ ] 타워 붕괴 감지 로직 구현 (기울기, 바닥 이탈)
*   [ ] 게임 오버 처리 및 결과 화면 표시
*   [ ] 최고 기록 로컬 DB (IndexedDB) 저장 및 불러오기

#### 4.2. 특수 블록 및 환경 변수
*   [ ] **특수 블록:**
    *   [ ] 접착 블록 기능 구현 (물리적 접착 효과)
    *   [ ] 고무 블록 기능 구현 (높은 반발력/탄성)
    *   [ ] 가속 블록 기능 구현 (빠른 낙하 속도, 추가 점수 로직)
    *   [ ] 유리 블록 기능 구현 (낮은 내구도, 가벼움)
    *   [ ] 특수 블록 등장 확률/조건 로직 구현
*   [ ] **환경 변수:**
    *   [ ] 돌풍 효과 구현 (모든 블록에 힘 가하기)
    *   [ ] 중력 변화 효과 구현 (물리 엔진 중력 값 변경)
    *   [ ] 방해 드론 객체 구현 및 이동 로직
    *   [ ] 환경 변수 발동 조건 로직 구현 (높이, 시간)
    *   [ ] 각 효과에 대한 시각/청각 이펙트 추가

#### 4.3. 게임 모드
*   [ ] **클래식 모드:**
    *   [ ] 무한 높이 쌓기 로직
*   [ ] **타임 어택 모드:**
    *   [ ] 제한 시간 카운트다운 UI 및 로직
    *   [ ] 시간 초과 시 게임 오버 처리
*   [ ] **일일 도전 모드:**
    *   [ ] 로컬 시간을 기반으로 하는 시드 값 생성 로직
    *   [ ] 시드 값을 이용한 블록 시퀀스 고정 로직
*   [ ] **퍼즐 모드:**
    *   [ ] 스테이지 목록 관리 (IndexedDB)
    *   [ ] 각 스테이지별 목표 (예: 10m 이상, 특정 모양 완성) 정의 및 달성 여부 체크 로직
    *   [ ] 스테이지 클리어 시 다음 스테이지 해금 로직

#### 4.4. 성장 및 수집
*   [ ] **코인 시스템:**
    *   [ ] 게임 플레이 결과에 따른 코인 획득 로직
    *   [ ] 코인 잔액 UI 표시 및 로컬 DB 저장
*   [ ] **블록 스킨 & 테마:**
    *   [ ] 다양한 블록 스킨/테마 에셋 제작 (이미지, 3D 모델)
    *   [ ] 뽑기 시스템 UI 및 애니메이션 구현
    *   [ ] 뽑기 결과에 따른 스킨/테마 획득 및 로컬 DB 저장
    *   [ ] 획득한 스킨/테마 적용 기능
*   [ ] **업적 및 칭호:**
    *   [ ] 업적 목록 정의 및 달성 조건 감지 로직
    *   [ ] 업적 달성 시 알림 및 로컬 DB 저장
    *   [ ] 칭호 목록 정의 및 업적 연동 로직
    *   [ ] 칭호 선택 및 적용 UI
*   [ ] **나만의 박물관:**
    *   [ ] 박물관 메뉴 UI 구현
    *   [ ] 획득한 스킨/테마 목록 불러와 전시 (회전/확대 가능)

#### 4.5. 경쟁 및 공유 기능
*   [ ] **챌린지 코드:**
    *   [ ] 플레이 데이터 (블록 시퀀스, 드롭 시간/위치) 기록 로직
    *   [ ] 기록된 데이터를 압축 및 암호화하여 챌린지 코드 생성 로직 (LZ-String, crypto-js 활용)
    *   [ ] 챌린지 코드 복사 버튼 구현
    *   [ ] 챌린지 코드 입력 UI 및 파싱 로직 (복호화, 압축 해제)
*   [ ] **고스트 리플레이:**
    *   [ ] 파싱된 챌린지 코드 데이터로 고스트 플레이 재현 로직
    *   [ ] 고스트 블록 렌더링 (반투명, 비충돌)
*   [ ] **명장면 GIF:**
    *   [ ] 게임 화면 녹화 시작/종료 트리거 로직 (예: 최고 높이 갱신, 타워 붕괴 직전)
    *   [ ] 클라이언트 측 GIF 인코딩 라이브러리 연동 (`gif.js` 등)
    *   [ ] 생성된 GIF 미리보기 UI
    *   [ ] GIF 다운로드 버튼 및 Web Share API 연동 공유 버튼 구현

#### 4.6. UI/UX
*   [ ] 메인 메뉴 화면 (게임 시작, 모드 선택, 박물관, 설정 등)
*   [ ] 게임 플레이 중 UI (점수, 높이, 타이머, 일시정지 버튼)
*   [ ] 게임 오버/결과 화면 (최종 점수, 최고 기록, 다시하기, 공유)
*   [ ] 설정 화면 (사운드/음악 볼륨 조절, 진동 ON/OFF)
*   [ ] 상점/뽑기 화면 (코인 잔액 표시, 뽑기 버튼, 결과 화면)
*   [ ] 박물관/업적/칭호 화면
*   [ ] 튜토리얼 또는 간단한 게임 안내 화면

#### 4.7. 사운드 및 이펙트
*   [ ] 배경 음악 추가 및 재생/정지/볼륨 조절 기능
*   [ ] 블록 드롭 효과음
*   [ ] 블록 충돌 효과음
*   [ ] 타워 붕괴 효과음
*   [ ] 특수 블록 사용 효과음 (예: 접착 시 '착' 소리)
*   [ ] 환경 변수 발동 효과음 (예: 돌풍 소리)
*   [ ] UI 상호작용 효과음 (버튼 클릭 등)
